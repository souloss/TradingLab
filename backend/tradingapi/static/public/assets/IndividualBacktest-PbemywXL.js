import{u as E,r,j as e,a as z,b as B}from"./index-BqnQO_M6.js";import{u as R,L as c,S as V}from"./StrategyCard-Cca5oljW.js";import{C as v,a as C,b as y,c as S}from"./card-C7GlTf0J.js";import{I as d}from"./check-C7CBMCW6.js";import{B as m}from"./button-HS5CxcCp.js";import"./createLucideIcon-DKOSkoD1.js";const k=[{id:"macd",name:"MACD策略",type:"MACD",description:"移动平均收敛发散指标，适用于趋势跟踪",icon:"fas fa-chart-line",color:"text-blue-600",bgColor:"bg-blue-50",borderColor:"border-blue-200"},{id:"ma",name:"双均线策略",type:"MA",description:"短期与长期均线交叉信号",icon:"fas fa-chart-area",color:"text-green-600",bgColor:"bg-green-50",borderColor:"border-green-200"},{id:"atr",name:"ATR策略",type:"ATR",description:"平均真实波动范围，用于止损和趋势判断",icon:"fas fa-signal",color:"text-orange-600",bgColor:"bg-orange-50",borderColor:"border-orange-200"},{id:"volume",name:"成交量策略",type:"VOLUME",description:"基于成交量变化的买卖信号",icon:"fas fa-volume-up",color:"text-purple-600",bgColor:"bg-purple-50",borderColor:"border-purple-200"}];function U(){const[,x]=E(),[u,P]=r.useState("001335"),g=new Date,p=new Date;p.setFullYear(g.getFullYear()-1);const f=s=>s.toISOString().split("T")[0],[h,D]=r.useState(f(p)),[j,A]=r.useState(f(g)),[t,M]=r.useState("volume"),[b,w]=r.useState({macd:{fastPeriod:12,slowPeriod:26,signalPeriod:9},ma:{shortPeriod:5,longPeriod:20},atr:{atr_period:14,period:20,atr_multiplier:1.5},volume:{period:60,buyVolumeMultiplier:.4,sellVolumeMultiplier:3}}),[a,o]=r.useState(!1),l=R({mutationFn:async()=>{if(!t)throw new Error("请选择一个策略");const n={type:k.find(i=>i.id===t).type,parameters:b[t],optimize:a};return await B("POST","/api/v1/backtest/stock",{stockCode:u,startDate:h,endDate:j,strategy:n})},onSuccess:s=>{x("/results/"+s.id)}}),O=s=>{M(t===s?null:s),a&&o(!1)},F=(s,n,N)=>{w(i=>({...i,[s]:{...i[s],[n]:N}})),a&&o(!1)},L=()=>{if(!t){alert("请先选择一个策略");return}o(!0)},T=()=>{if(!t){alert("请选择一个策略");return}l.mutate()};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx(z,{isVisible:l.isPending}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-success text-success-foreground rounded-lg p-2",children:e.jsx("i",{className:"fas fa-search-dollar"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"个股回测"})]}),e.jsx("p",{className:"text-muted-foreground",children:"针对单只股票进行精确的策略回测分析，支持多种技术指标组合运用"})]}),e.jsxs(v,{className:"mb-6",children:[e.jsx(C,{children:e.jsxs(y,{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"fas fa-info-circle text-primary"}),e.jsx("span",{children:"基本信息"})]})}),e.jsx(S,{children:e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"stock-code",className:"text-sm font-medium",children:"股票代码 *"}),e.jsx(d,{id:"stock-code",placeholder:"请输入6位股票代码",value:u,onChange:s=>P(s.target.value),className:"mt-1"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"请输入6位股票代码"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"start-date",className:"text-sm font-medium",children:"开始日期"}),e.jsx(d,{id:"start-date",type:"date",value:h,onChange:s=>D(s.target.value),className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"end-date",className:"text-sm font-medium",children:"结束日期"}),e.jsx(d,{id:"end-date",type:"date",value:j,onChange:s=>A(s.target.value),className:"mt-1"})]})]})})]}),e.jsxs(v,{className:"mb-6",children:[e.jsxs(C,{children:[e.jsxs(y,{className:"flex items-center space-x-2",children:[e.jsx("i",{className:"fas fa-cog text-primary"}),e.jsx("span",{children:"策略配置"})]}),e.jsx("p",{className:"text-muted-foreground",children:"选择并配置您的量化交易策略"})]}),e.jsxs(S,{children:[e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:k.map(s=>e.jsx("div",{className:"space-y-4",children:e.jsx(V,{strategy:s,isSelected:t===s.id,parameters:b[s.id],onToggle:O,onParameterChange:F,isSingleSelect:!0})},s.id))}),e.jsx("div",{className:"mt-6 flex justify-center",children:e.jsxs(m,{variant:a?"default":"outline",className:`${a?"bg-indigo-600 hover:bg-indigo-700":"border-indigo-600 text-indigo-600 hover:bg-indigo-50"}`,onClick:L,disabled:!t,children:[e.jsx("i",{className:`fas ${a?"fa-check-circle":"fa-magic"} mr-2`}),a?"已启用自动参数优化":"自动策略参数调优"]})}),a&&e.jsx("div",{className:"mt-4 p-4 bg-indigo-50 rounded-lg border border-indigo-200",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("i",{className:"fas fa-info-circle text-indigo-600 mt-1 mr-2"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-indigo-800",children:"自动参数优化已启用"}),e.jsx("p",{className:"text-sm text-indigo-600 mt-1",children:"系统将自动为选定的策略寻找最优参数组合，无需手动调整。回测时间可能会稍长，但结果更加客观准确。"})]})]})})]})]}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx(m,{variant:"outline",onClick:()=>x("/"),children:"返回首页"}),e.jsxs(m,{onClick:T,className:"bg-success text-success-foreground hover:bg-success/90",disabled:l.isPending||!t,children:[e.jsx("i",{className:"fas fa-play mr-2"}),"开始回测"]})]})]})}export{U as default};
